[id="controller-set-up-SAML"]

= Setting up SAML authentication

SAML allows the exchange of authentication and authorization data between an Identity Provider (IdP - a system of servers that provide the Single Sign On service) and a service provider, in this case, {ControllerName}. 

You can configure {ControllerName} to talk with SAML in order to authenticate (create/login/logout) {ControllerName} users. 
You can embed User, Team, and Organization membership in the SAML response to {ControllerName}.

image::ag-configure-auth-saml-topology.png[SAML topology]

The following instructions describe {ControllerName} as the service provider. 
To authenticate users through RHSSO (keycloak), see link:https://www.ansible.com/blog/red-hat-single-sign-on-integration-with-ansible-tower[Red Hat Single Sign On Integration with the Automation Controller].

.Procedure

. From the navigation panel, select menu:Settings[].
. Select *SAML settings* from the list of *Authentication* options.
+
[NOTE]
====
The *SAML Assertion Consume Service (ACS) URL* and *SAML Service Provider Metadata URL* fields are pre-populated and are non-editable. Contact the Identity Provider administrator and provide the information contained in these fields
====
. Click btn:[Edit] and set the *SAML Service Provider Entity ID* to be the same as the *Base URL* of the {ControllerName} host field, found in the *Miscellaneous System settings* screen.
You can view it through the API in the `/api/v2/settings/system`, under the `CONTROLLER_BASE_URL` variable. 
You can set the *Entity ID* to any one of the individual {ControllerName} cluster nodes, but it is good practice to set it to the URL of the service provider. 
Ensure that the *Base URL* matches the FQDN of the load balancer, if used.
+
[NOTE]
====
The *Base URL* is different for each node in a cluster. 
A load balancer often sits in front of {ControllerName} cluster nodes to provide a single entry point, the {ControllerName} Cluster FQDN. 
The SAML service provider must be able establish an outbound connection and route to the {ControllerName} Cluster Node or the {ControllerName} Cluster FQDN that you set in the *SAML Service Provider Entity ID*.
====
+
In the following example, the service provider is the {ControllerName} cluster, and therefore, the ID is set to the {ControllerName} Cluster FQDN:
+
image::configure-auth-saml-service-provider.png[SAML service provider]
+
. Create a server certificate for the Ansible cluster. 
Typically when an Ansible cluster is configured, the {ControllerName} nodes are configured to handle HTTP traffic only and the load balancer is an SSL Termination Point. 
In this case, an SSL certificate is required for the load balancer, and not for the individual {ControllerName} Cluster Nodes. 
You can enable or disable SSL per individual {ControllerName} node, but you must disable when using an SSL terminated load balancer. 
Use a non-expiring self signed certificate to avoid periodically updating certificates. 
This way, authentication does not fail in case someone forgets to update the certificate.
